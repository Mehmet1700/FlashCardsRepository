<!doctype html><html lang="en"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Flashcards</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:680px;margin:0 auto;padding:16px}
.card{border:1px solid #ddd;border-radius:16px;padding:24px;box-shadow:0 1px 8px rgba(0,0,0,.06);margin-top:16px}
.front{font-size:1.4rem;font-weight:600}
.back{font-size:1.2rem;margin-top:12px;display:none}
.row{display:flex;gap:8px;margin-top:16px}
button{flex:1;padding:12px 14px;border-radius:12px;border:1px solid #ccc;background:#fff}
.muted{color:#666;font-size:.9rem;margin-top:8px}
</style>
<h1>Flashcards</h1>
<div id="stats" class="muted">Loadingâ€¦</div>
<div id="card" class="card" hidden>
  <div id="front" class="front"></div>
  <div id="back" class="back"></div>
  <div class="row">
    <button id="show">Show</button>
    <button id="again" hidden>Again</button>
    <button id="good"  hidden>Good</button>
    <button id="easy"  hidden>Easy</button>
  </div>
</div>
<script>
let cards=[], queue=[];

function due(c){ return !c.next_review || new Date(c.next_review) <= new Date(); }

async function load(){
  const r = await fetch('/api/cards',{cache:'no-store'});
  const d = await r.json(); cards = d.cards||[];
  queue = cards.filter(due);
  document.getElementById('stats').textContent = `${queue.length} due / ${cards.length} total`;
  next();
}
function next(){
  const el = document.getElementById('card');
  if(queue.length===0){ el.hidden=true; document.getElementById('stats').textContent='All done ðŸŽ‰'; return; }
  el.hidden=false;
  const c = queue[0];
  document.getElementById('front').textContent = c.front;
  const back = document.getElementById('back'); back.textContent = c.back; back.style.display='none';
  document.getElementById('show').hidden=false;
  document.getElementById('again').hidden=true; document.getElementById('good').hidden=true; document.getElementById('easy').hidden=true;
}
function reveal(){
  document.getElementById('back').style.display='block';
  document.getElementById('show').hidden=true;
  document.getElementById('again').hidden=false; document.getElementById('good').hidden=false; document.getElementById('easy').hidden=false;
}
function schedule(card, rating){
  const now=new Date(); const ease=Math.max(1.3,(card.ease||2.5)+(rating==='easy'?+0.15:rating==='again'?-0.2:0));
  let iv=card.interval||0;
  if(rating==='again'){ iv=0.01; } else if(iv===0){ iv=1; } else { iv=Math.round(iv*ease); }
  const next=new Date(now.getTime()+iv*86400000);
  Object.assign(card,{ease,interval:iv,next_review:next.toISOString()});
}
async function answer(r){
  const c = queue.shift(); schedule(c,r);
  // optional: persist progress; you can remove this if you want read-only on phone
  fetch('/api/cards',{
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':'Bearer WRITE_TOKEN_HERE'},
    body: JSON.stringify(c)
  }).catch(()=>{});
  next();
}
document.getElementById('show').onclick=reveal;
document.getElementById('again').onclick=()=>answer('again');
document.getElementById('good').onclick =()=>answer('good');
document.getElementById('easy').onclick =()=>answer('easy');
load();
</script>
